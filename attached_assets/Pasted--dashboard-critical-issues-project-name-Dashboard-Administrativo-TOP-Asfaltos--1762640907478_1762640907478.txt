{
  "dashboard_critical_issues": {
    "project_name": "Dashboard Administrativo - TOP Asfaltos",
    "analysis_date": "2025-11-08",
    
    "top_3_critical_problems": [
      {
        "rank": 1,
        "category": "Charts Broken / Unusable",
        "severity": "CRITICAL",
        "issue": "Gr√°ficos completamente quebrados, sobrepostos e ileg√≠veis",
        "details": {
          "affected_charts": [
            {
              "chart_name": "An√°lise de Per√≠odo - Margem",
              "problems": [
                "Dois eixos Y incompat√≠veis (R$ milhares vs percentual)",
                "Barras azuis e linha verde totalmente sobrepostas",
                "Imposs√≠vel distinguir valores reais",
                "Labels de data em 45¬∞ graus ileg√≠veis",
                "Escala autom√°tica deixa barras min√∫sculas",
                "N√£o h√° como saber qual valor corresponde a qual eixo"
              ],
              "current_state": "INUTILIZ√ÅVEL - 0% de valor anal√≠tico",
              "user_impact": "Imposs√≠vel tomar decis√µes baseadas neste gr√°fico",
              "screenshot_evidence": "Barras quase invis√≠veis com linha atravessando tudo"
            },
            {
              "chart_name": "Waterfall - Top Custos Fixos",
              "problems": [
                "N√ÉO √© um waterfall real (falta efeito cascata)",
                "Barras desconectadas sem fluxo visual",
                "Cores laranja, amarelo e vermelho muito similares",
                "Falta indicar se √© entrada (+) ou sa√≠da (-)",
                "Escala do eixo Y confusa (R$ 0,00 a 100.000,00 em incrementos estranhos)",
                "Labels sobrepostas no eixo X"
              ],
              "current_state": "ENGANOSO - Parece waterfall mas n√£o funciona como tal",
              "user_impact": "An√°lise incorreta de fluxo de custos",
              "what_it_should_be": "Deve mostrar Receita inicial ‚Üí subtrair cada custo ‚Üí resultado final"
            },
            {
              "chart_name": "Heatmap de Vendas por Hor√°rio",
              "problems": [
                "SEM LEGENDA - imposs√≠vel saber o que as cores significam",
                "N√£o mostra valores nos quadrados",
                "Cores muito pr√≥ximas (dif√≠cil distinguir intensidade)",
                "N√£o fica claro se azul escuro = muito ou pouco",
                "Labels de hor√°rio comprimidas",
                "Falta contexto: √© quantidade de servi√ßos? Valor R$?"
              ],
              "current_state": "IN√öTIL - Decorativo apenas",
              "user_impact": "Zero insights sobre melhores hor√°rios de opera√ß√£o"
            }
          ],
          "root_cause": "Biblioteca de gr√°ficos mal configurada ou dados mal estruturados",
          "immediate_risk": "Usu√°rios n√£o confiam no sistema e voltam para planilhas Excel"
        },
        "solution": {
          "emergency_fix": {
            "timeline": "24-48 horas",
            "actions": [
              {
                "chart": "An√°lise de Per√≠odo - Margem",
                "fix": "SEPARAR IMEDIATAMENTE em dois gr√°ficos",
                "implementation": {
                  "graph_1": {
                    "title": "üí∞ Margem em Reais por Dia",
                    "type": "Gr√°fico de barras vertical simples",
                    "library": "Recharts BarChart",
                    "config": {
                      "xAxis": "Data (horizontal, leg√≠vel)",
                      "yAxis": "Valor em R$ (com formata√ß√£o de moeda)",
                      "bars": "Gradiente verde (lucro alto) ‚Üí vermelho (lucro baixo)",
                      "tooltip": "R$ {value} em {date} | {percentageVsAverage}% vs m√©dia",
                      "reference_line": "Linha pontilhada mostrando m√©dia do per√≠odo"
                    }
                  },
                  "graph_2": {
                    "title": "üìä Margem Percentual sobre Faturamento",
                    "type": "Gr√°fico de linha com √°rea",
                    "library": "Recharts AreaChart",
                    "config": {
                      "xAxis": "Data (mesma escala do gr√°fico acima)",
                      "yAxis": "Percentual 0-100%",
                      "line": "Linha azul grossa",
                      "area": "√Årea azul com 20% opacidade",
                      "tooltip": "{percentage}% em {date}",
                      "reference_line": "Meta de margem (configur√°vel)"
                    }
                  }
                },
                "code_example": "Ver se√ß√£o code_fixes abaixo"
              },
              {
                "chart": "Waterfall - Top Custos Fixos",
                "fix": "RECONSTRUIR como waterfall verdadeiro",
                "implementation": {
                  "title": "üí∏ Cascata de Receitas e Custos",
                  "type": "Waterfall chart real",
                  "library": "Recharts customizado ou Victory Charts",
                  "data_structure": [
                    {"name": "Receita Bruta", "value": 7500, "type": "total", "color": "#10b981"},
                    {"name": "(-) Custos Vari√°veis", "value": -660, "type": "decrease", "color": "#ef4444"},
                    {"name": "Margem Contribui√ß√£o", "value": 6840, "type": "subtotal", "color": "#3b82f6"},
                    {"name": "(-) Custos Fixos", "value": -8560, "type": "decrease", "color": "#f59e0b"},
                    {"name": "Resultado L√≠quido", "value": -1720, "type": "total", "color": "#dc2626"}
                  ],
                  "visual_rules": {
                    "total_bars": "Barras completas desde zero",
                    "change_bars": "Barras flutuantes mostrando delta",
                    "connectors": "Linhas pontilhadas conectando fim de uma barra ao in√≠cio da pr√≥xima",
                    "labels": "Valores sobre cada barra com sinal (+ ou -)"
                  }
                }
              },
              {
                "chart": "Heatmap de Vendas",
                "fix": "ADICIONAR LEGENDA e valores",
                "implementation": {
                  "title": "üïê Mapa de Calor: Volume de Vendas por Hor√°rio",
                  "type": "Heatmap com annotations",
                  "library": "Recharts ou Nivo Heatmap",
                  "fixes": [
                    "Adicionar legenda lateral: 'Baixo ‚Üê ‚Üí Alto'",
                    "Escala de cores: Azul claro (#e0f2fe) ‚Üí Azul escuro (#0c4a6e)",
                    "Mostrar valor no hover: '{count} servi√ßos √†s {hour} em {day}'",
                    "Marcar com ‚òÖ os 3 hor√°rios mais rent√°veis",
                    "Adicionar subt√≠tulo: 'Quantidade de servi√ßos realizados'"
                  ],
                  "color_scale": {
                    "min": "#f0f9ff",
                    "mid": "#3b82f6",
                    "max": "#1e3a8a"
                  }
                }
              }
            ]
          },
          "permanent_fix": {
            "timeline": "1-2 semanas",
            "requirements": [
              "Audit completo de todos os gr√°ficos",
              "Estabelecer design system para charts",
              "Documentar regras de quando usar cada tipo de gr√°fico",
              "Testes de usabilidade com 5+ usu√°rios",
              "Garantir responsividade mobile/tablet"
            ]
          }
        },
        "impact": "CR√çTICO - Dashboard inteiro perde credibilidade",
        "effort_to_fix": "M√âDIO - 16-24 horas de dev para fix emergencial",
        "business_impact": {
          "current_loss": "Usu√°rios tomam decis√µes sem dados visuais confi√°veis",
          "potential_gain": "Insights 10x mais r√°pidos com gr√°ficos funcionais",
          "user_satisfaction": "De 3/10 para 8/10"
        }
      },
      
      {
        "rank": 2,
        "category": "Data Integrity",
        "severity": "CRITICAL",
        "issue": "Resultado l√≠quido negativo sem contexto ou explica√ß√£o",
        "details": {
          "current_value": "-R$ 1.720,50",
          "percentage": "-80,62%",
          "problem": "Valor negativo em destaque vermelho causa alarme sem fornecer an√°lise do que causou essa varia√ß√£o dr√°stica",
          "missing_information": [
            "Compara√ß√£o com per√≠odo anterior (qual per√≠odo?)",
            "Breakdown de onde veio essa perda",
            "Tend√™ncia (est√° melhorando ou piorando?)",
            "A√ß√µes recomendadas para revers√£o",
            "Contexto: √© normal para a sazonalidade?"
          ],
          "math_validation": {
            "expected": "Faturamento (R$ 7.500) - Desp. Vari√°veis (R$ 660,50) - Desp. Fixas (R$ 8.560) = -R$ 1.720,50",
            "status": "‚úì C√°lculo correto",
            "problem": "Despesas fixas muito altas em rela√ß√£o ao faturamento (114% da receita!)"
          }
        },
        "solution": {
          "immediate": "Adicionar card 'DRE Visual' ao lado do resultado",
          "design": {
            "component": "Sankey Diagram ou Waterfall vertical",
            "flow": "Receita ‚Üí Custos Vari√°veis ‚Üí Margem Contribui√ß√£o ‚Üí Custos Fixos ‚Üí Resultado",
            "colors": {
              "receita": "Verde #10b981",
              "custos": "Vermelho #ef4444",
              "resultado_positivo": "Azul #3b82f6",
              "resultado_negativo": "Vermelho escuro #dc2626"
            },
            "insights_auto": [
              "üî¥ Custos fixos representam 114% da receita",
              "‚ö†Ô∏è Ponto de equil√≠brio: R$ 8.560 de faturamento necess√°rio",
              "üí° Reduzir custos fixos em 20% tornaria resultado positivo"
            ]
          },
          "short_term": "Implementar drill-down que mostra exatamente quais despesas aumentaram ou receitas ca√≠ram",
          "long_term": "Sistema de alertas preventivos quando resultado tender a negativo"
        },
        "impact": "ALTO - Usu√°rio pode tomar decis√µes precipitadas ou perder confian√ßa no sistema",
        "effort_to_fix": "M√âDIO - Requer ajuste de query e novo componente visual (8 horas)"
      },
      
      {
        "rank": 3,
        "category": "Information Architecture",
        "severity": "HIGH",
        "issue": "Sobrecarga de informa√ß√£o sem hierarquia clara",
        "details": {
          "problems": [
            "Usu√°rio precisa fazer scroll excessivo para encontrar informa√ß√£o",
            "N√£o h√° separa√ß√£o clara entre dados estrat√©gicos e operacionais",
            "Listas longas de despesas ocupam espa√ßo valioso",
            "Performance mensal √© s√≥ tabela - dif√≠cil ver tend√™ncias",
            "Insights inteligentes perdidos no meio do dashboard",
            "Gr√°ficos quebrados ocupam espa√ßo premium sem agregar valor"
          ],
          "cognitive_load": "ALTO - Excesso de dados simult√¢neos prejudica an√°lise",
          "user_pain_points": [
            "Onde est√° a informa√ß√£o mais importante?",
            "Como sei se meu neg√≥cio est√° saud√°vel?",
            "Preciso analisar tudo ou posso focar em algo espec√≠fico?",
            "Por que metade dos gr√°ficos n√£o fazem sentido?"
          ]
        },
        "solution": {
          "immediate": "Reorganizar em estrutura de 3 n√≠veis + remover gr√°ficos quebrados",
          "new_structure": {
            "nivel_1_overview": {
              "position": "Topo - Sempre vis√≠vel (acima da dobra)",
              "content": [
                "Sem√°foro de sa√∫de do neg√≥cio (üî¥ Vermelho neste caso)",
                "4 KPIs principais em cards grandes",
                "Top 3 alertas mais cr√≠ticos COM A√á√ÉO",
                "Mini-gr√°fico de tend√™ncia de receita (sparkline)"
              ],
              "space_saved": "Remover gr√°ficos quebrados libera 60% do espa√ßo",
              "goal": "Responder em 5 segundos: 'Como est√° meu neg√≥cio?'"
            },
            "nivel_2_analise": {
              "position": "Tabs ou se√ß√µes expans√≠veis",
              "tabs": [
                {
                  "tab": "üìä Servi√ßos",
                  "content": "Rankings (com gr√°ficos funcionais), an√°lise de margem, heatmap CORRIGIDO"
                },
                {
                  "tab": "üí∞ Financeiro",
                  "content": "DRE visual (waterfall CORRETO), top 10 despesas, fluxo de caixa"
                },
                {
                  "tab": "üìà Performance",
                  "content": "Gr√°ficos de tend√™ncia (linha simples), compara√ß√µes per√≠odos"
                }
              ],
              "goal": "Drill-down focado sem distra√ß√µes"
            },
            "nivel_3_detalhes": {
              "position": "Modals on-demand",
              "trigger": "Clicar em qualquer m√©trica",
              "content": "Tabelas completas, hist√≥rico, exporta√ß√£o",
              "goal": "An√°lise profunda quando necess√°rio"
            }
          },
          "priority_order": [
            "1. Consertar gr√°ficos quebrados",
            "2. Reorganizar hierarquia",
            "3. Adicionar contexto ao resultado negativo",
            "4. Implementar drill-downs"
          ]
        },
        "impact": "MUITO ALTO - Usu√°rio perde tempo e pode ignorar informa√ß√µes cr√≠ticas",
        "effort_to_fix": "ALTO - Requer redesign (40 horas), mas quick wins poss√≠veis (12 horas)"
      }
    ],
    
    "code_fixes": {
      "description": "Exemplos de c√≥digo para corrigir os gr√°ficos quebrados",
      "fix_1_margem_separada": {
        "before": "1 gr√°fico com barras + linha e dois eixos Y",
        "after": "2 gr√°ficos empilhados e independentes",
        "react_code": `
// Gr√°fico 1: Margem em R$
<ResponsiveContainer width="100%" height={250}>
  <BarChart data={margemData}>
    <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
    <XAxis 
      dataKey="data" 
      tick={{ fontSize: 12 }}
      angle={0}
    />
    <YAxis 
      tickFormatter={(value) => \`R$ \${value.toLocaleString()}\`}
    />
    <Tooltip 
      formatter={(value) => \`R$ \${value.toLocaleString('pt-BR')}\`}
      labelStyle={{ color: '#374151' }}
    />
    <ReferenceLine 
      y={mediaMargemRS} 
      stroke="#6b7280" 
      strokeDasharray="5 5"
      label="M√©dia"
    />
    <Bar dataKey="margemRS" fill="#10b981" radius={[4, 4, 0, 0]} />
  </BarChart>
</ResponsiveContainer>

// Gr√°fico 2: Margem %
<ResponsiveContainer width="100%" height={200}>
  <AreaChart data={margemData}>
    <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
    <XAxis dataKey="data" tick={{ fontSize: 12 }} />
    <YAxis 
      domain={[0, 100]}
      tickFormatter={(value) => \`\${value}%\`}
    />
    <Tooltip formatter={(value) => \`\${value.toFixed(1)}%\`} />
    <ReferenceLine 
      y={metaMargemPercent} 
      stroke="#ef4444" 
      strokeDasharray="5 5"
      label="Meta"
    />
    <Area 
      type="monotone" 
      dataKey="margemPercent" 
      stroke="#3b82f6" 
      fill="#3b82f6" 
      fillOpacity={0.2}
      strokeWidth={2}
    />
  </AreaChart>
</ResponsiveContainer>
        `
      },
      "fix_2_waterfall_real": {
        "library": "recharts com customiza√ß√£o",
        "react_code": `
const waterfallData = [
  { name: 'Receita', value: 7500, start: 0, color: '#10b981', type: 'positive' },
  { name: 'Custos Var.', value: 660.50, start: 7500 - 660.50, color: '#ef4444', type: 'negative' },
  { name: 'Margem Contr.', value: 6839.50, start: 0, color: '#3b82f6', type: 'subtotal' },
  { name: 'Custos Fixos', value: 8560, start: 6839.50 - 8560, color: '#f59e0b', type: 'negative' },
  { name: 'Resultado', value: -1720.50, start: 0, color: '#dc2626', type: 'total' }
];

<ResponsiveContainer width="100%" height={350}>
  <BarChart data={waterfallData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="name" />
    <YAxis tickFormatter={(v) => \`R$ \${v.toLocaleString()}\`} />
    <Tooltip 
      formatter={(value, name, props) => {
        const sign = props.payload.type === 'negative' ? '-' : '';
        return \`\${sign}R$ \${Math.abs(value).toLocaleString('pt-BR')}\`;
      }}
    />
    <Bar dataKey="value" stackId="a">
      {waterfallData.map((entry, index) => (
        <Cell key={\`cell-\${index}\`} fill={entry.color} />
      ))}
    </Bar>
  </BarChart>
</ResponsiveContainer>
        `
      },
      "fix_3_heatmap_legivel": {
        "library": "@nivo/heatmap ou recharts customizado",
        "react_code": `
<ResponsiveHeatMap
  data={heatmapData}
  margin={{ top: 60, right: 90, bottom: 60, left: 90 }}
  valueFormat=">-.0f"
  axisTop={{
    tickSize: 5,
    tickPadding: 5,
    legend: 'Dia da Semana',
    legendPosition: 'middle',
    legendOffset: -40
  }}
  axisLeft={{
    tickSize: 5,
    tickPadding: 5,
    legend: 'Hor√°rio',
    legendPosition: 'middle',
    legendOffset: -60
  }}
  colors={{
    type: 'sequential',
    scheme: 'blues',
    minValue: 0,
    maxValue: maxVendas
  }}
  legends={[
    {
      anchor: 'bottom',
      translateX: 0,
      translateY: 30,
      length: 400,
      thickness: 8,
      direction: 'row',
      title: 'Quantidade de Servi√ßos ‚Üí',
      titleAlign: 'start',
      titleOffset: 4
    }
  ]}
  tooltip={({ xKey, yKey, value }) => (
    <div style={{
      background: 'white',
      padding: '9px 12px',
      border: '1px solid #ccc',
      borderRadius: '4px'
    }}>
      <strong>{yKey} - {xKey}</strong>
      <br />
      {value} servi√ßos realizados
    </div>
  )}
/>
        `
      }
    },
    
    "quick_wins": {
      "description": "A√ß√µes imediatas para tornar dashboard us√°vel hoje",
      "timeline": "24-48 horas",
      "actions": [
        {
          "priority": 1,
          "action": "üö® REMOVER gr√°fico 'An√°lise de Per√≠odo' temporariamente",
          "replacement": "Tabela simples com margem R$ e % at√© gr√°fico ser corrigido",
          "effort": "30 minutos",
          "impact": "Para de confundir usu√°rios imediatamente"
        },
        {
          "priority": 2,
          "action": "üîß Corrigir Waterfall ou substituir por gr√°fico de barras empilhadas",
          "implementation": "Barras: Receita (verde) | Custos Vari√°veis (vermelho claro) | Custos Fixos (vermelho escuro)",
          "effort": "2-3 horas",
          "impact": "Visualiza√ß√£o imediata do problema de custos"
        },
        {
          "priority": 3,
          "action": "üé® Adicionar legenda manual ao heatmap existente",
          "implementation": "Div HTML com gradiente de cores + labels 'Baixo' e 'Alto'",
          "effort": "1 hora",
          "impact": "Heatmap se torna interpret√°vel"
        },
        {
          "priority": 4,
          "action": "üìä Criar card 'Por que meu resultado √© negativo?'",
          "content": "Mini DRE visual + texto explicativo + % de cada custo sobre receita",
          "effort": "3 horas",
          "impact": "Usu√°rio entende o problema financeiro"
        },
        {
          "priority": 5,
          "action": "‚¨ÜÔ∏è Mover 'Insights Inteligentes' para topo (antes dos gr√°ficos)",
          "effort": "15 minutos",
          "impact": "Alertas cr√≠ticos ficam vis√≠veis sem scroll"
        }
      ],
      "total_effort": "~8 horas de desenvolvimento",
      "expected_improvement": "Dashboard passa de 3/10 para 7/10 em usabilidade"
    },
    
    "testing_checklist": {
      "description": "Como validar que os gr√°ficos foram corrigidos",
      "tests": [
        {
          "test": "Gr√°fico de Margem",
          "criteria": [
            "‚úì Consigo ler todas as datas sem inclinar a cabe√ßa",
            "‚úì Valores em R$ e % est√£o claramente separados",
            "‚úì Posso identificar o melhor e pior dia em <10 segundos",
            "‚úì M√©dia do per√≠odo est√° vis√≠vel",
            "‚úì Tooltip mostra data + valor + compara√ß√£o com m√©dia"
          ]
        },
        {
          "test": "Waterfall de Custos",
          "criteria": [
            "‚úì Fluxo visual claro: Receita ‚Üí dedu√ß√µes ‚Üí Resultado",
            "‚úì Barras conectadas (n√£o flutuando no espa√ßo)",
            "‚úì Cores distintas para entrada (verde) vs sa√≠da (vermelho)",
            "‚úì Valores sobre as barras com sinal +/-",
            "‚úì Posso entender o fluxo sem ler legenda"
          ]
        },
        {
          "test": "Heatmap de Hor√°rios",
          "criteria": [
            "‚úì Legenda de cores presente e clara",
            "‚úì Consigo identificar os 3 melhores hor√°rios em <5 segundos",
            "‚úì Hover mostra valor exato",
            "‚úì Cores distingu√≠veis (n√£o tons muito pr√≥ximos)",
            "‚úì Labels de horas e dias leg√≠veis"
          ]
        },
        {
          "test": "Contexto Financeiro",
          "criteria": [
            "‚úì Resultado negativo tem explica√ß√£o visual ao lado",
            "‚úì Posso entender onde est√° o problema (custos fixos altos)",
            "‚úì H√° sugest√£o de a√ß√£o ou pr√≥ximos passos",
            "‚úì Consigo ver tend√™ncia (melhorando ou piorando)"
          ]
        }
      ],
      "user_acceptance": {
        "method": "Teste com 3 usu√°rios reais",
        "tasks": [
          "Identifique qual foi o dia com melhor margem",
          "Explique por que o resultado est√° negativo",
          "Qual hor√°rio/dia voc√™ deveria focar mais vendas?",
          "Qual √© o maior problema financeiro da empresa?"
        ],
        "success_criteria": "80% dos usu√°rios completam tarefas em <2 minutos"
      }
    },
    
    "prevention_measures": {
      "description": "Como evitar que gr√°ficos quebrem no futuro",
      "measures": [
        {
          "measure": "Design System para Charts",
          "details": [
            "Documentar quando usar cada tipo de gr√°fico",
            "Criar biblioteca de componentes pr√©-configurados",
            "Estabelecer paleta de cores padr√£o",
            "Definir regras de formata√ß√£o (moeda, percentual, datas)"
          ]
        },
        {
          "measure": "Code Review Checklist",
          "checklist": [
            "[ ] Gr√°fico tem t√≠tulo descritivo",
            "[ ] Eixos t√™m labels claros",
            "[ ] Tooltip mostra informa√ß√£o √∫til",
            "[ ] Cores s√£o distingu√≠veis (teste dalt√¥nico)",
            "[ ] Responsivo (testado mobile/tablet/desktop)",
            "[ ] Dados de exemplo realistas (n√£o Lorem Ipsum)",
            "[ ] Legenda presente quando necess√°ria"
          ]
        },
        {
          "measure": "Testes Automatizados",
          "tests": [
            "Snapshot tests dos gr√°ficos",
            "Teste de acessibilidade (cores, contraste)",
            "Teste de responsividade",
            "Valida√ß√£o de dados (n√£o aceitar nulls sem tratamento)"
          ]
        },
        {
          "measure": "User Testing Regular",
          "frequency": "A cada nova feature de gr√°fico",
          "method": "5-Second Test: usu√°rio v√™ gr√°fico por 5s e explica o que entendeu"
        }
      ]
    }
  }
}